<#include "../include/header.html">
<body>


<script src="${base.contextPath}/common/code?resourceTypeData=HAP_OM_ORDER_STATUS" type="text/javascript"></script>
<script type="text/javascript">
  
/*     var viewModel = kendo.observable({
    	
        model: {},
        saveFunction: function () {
            $('#inboundGrid').data('kendoGrid').saveChanges();
        },
        queryResource: function (e) {
        	alert("1");
            $('#inboundGrid').data('kendoGrid').dataSource.page(1);
        }
    }); */
  
</script>

<!-- 订单状态 -->
<script>
 var   viewModel_d = kendo.observable({
        model: {},
        resourceTypeData2: resourceTypeData,
        
    });
</script>

<!-- excel导出 -->
<script>
var viewModel = kendo.observable({
    model: {},
    queryResource: function (e) {

        $('#inboundGrid').data('kendoGrid').dataSource.page(1);
    },
    resetForm: function (e) {
    	
        var formData = viewModel.model.toJSON();
        for (var k in formData) {
            viewModel.model.set(k, null);
        }
    },
    exportExcelFunction: function (e) {
    	alert("1");
        var exportConfig = {};
        var columns = [];
        var index = 0;
        for (var i = 0; i < grid.columns.length; i++) {
            if (grid.columns[i].field != null) {
                var columnInfo = {};
                columnInfo["name"] = grid.columns[i].field;
                columnInfo["title"] = grid.columns[i].title;
                columnInfo["width"] = grid.columns[i].width;
                var align = $('tbody').find('tr')[0].getElementsByTagName('td')[i].style.textAlign;
                if (align != null || align != '') {
                    columnInfo["align"] = align;
                }
                if (inboundDataSource.options.schema.model.fields[grid.columns[i].field] != null) {
                    columnInfo["type"] = inboundDataSource.options.schema.model.fields[grid.columns[i].field].type;
                }
                columns[index] = columnInfo;
                index++;
            }
        }
        exportConfig["columnsInfo"] = columns;

        exportConfig["param"] = Hap.prepareQueryParameter(viewModel.model.toJSON());
        exportConfig["fileName"] = "HapExamOrder";
        var $inputImg = $('<input>').attr({name: "config", value: kendo.stringify(exportConfig)});
        var $inputToken=$('<input>').attr({name:"${_csrf.parameterName}",value:"${_csrf.token}",type:"hidden"});
     //   var $inputSubmitBtn=$('<input>').attr({type:"submit",value:"submit"});
        var $form = $("<form>");
        $form.attr({
            target: '_self',
            method: 'post',
            action: '${base.contextPath}/HapExam/Order/export'
        }).append($inputImg);
        $form.append($inputToken);
     //   $form.append($inputSubmitBtn);
        $form.id='smbForm';
        $("#batchDiv").empty().append($form);
        $($form).submit();
        $("#batchDiv").empty();
    }
});

</script>





<div id="batchDiv" style="display: none"></div>
 <div id="roleWin"></div>
<div class="col-sm-12" style="margin-top: 10px;">

    <div id="tabstrip">
  
        <div id="page-content">
            <div class="panel" id="inQuery" style="padding: 0px;border:none;box-shadow: none;">
                <form class="form-horizontal" id="myForm">
                    <div class="panel-body">
                        <div class="row" style="margin-bottom: 10px;">
                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">公司名称</label>
                                    <div class="col-sm-8">
                                        <input type="text" id="parentId2" placeholder='<@spring.message ""/>'
                       style="width:150px;" data-bind="value:model.companyId">
                <script>
                    $("#parentId2").kendoLov($.extend(${lovProvider.getLov(base.contextPath, base.locale, "HapExam_LV_COMPANY")}, {
                        query: function (e) {
                            e.param['enabledFlag'] = 'Y';
                        }
                    }))
                </script>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-4">
                              <div class="form-group">
                                <label class="col-sm-3 control-label">客户名称</label>
                                <div class="col-sm-8">
                                    <input type="text" id="parentId3" placeholder='<@spring.message ""/>'
                       style="width:150px;" data-bind="value:model.customerId">
                                             <script>
                    $("#parentId3").kendoLov($.extend(${lovProvider.getLov(base.contextPath, base.locale, "HapExam_LV_CUSTOMERS")}, {
                        query: function (e) {
                            e.param['enabledFlag'] = 'Y';
                        }
                    }))
                </script>
                                           
                                           
                                </div>
                              </div>
                           </div>
                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">销售订单号</label>
                                    <div class="col-sm-8">
                                    <input type="text" style="width: 100%"
                                           data-bind="value:model.orderNumber" class="k-textbox">
                                </div>
                                </div>
                            </div>
                        </div>
                        <div class="row ">
                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">物料</label>
                                  <div class="col-sm-8">
                                  <input type="text" id="parentId4" placeholder='<@spring.message ""/>'
                       style="width:150px;" data-bind="value:model.inventoryItemId">
                                             <script>
                    $("#parentId4").kendoLov($.extend(${lovProvider.getLov(base.contextPath, base.locale, "HapExam_LV_ITEM")}, {
                        query: function (e) {
                            e.param['enabledFlag'] = 'Y';
                        }
                    }))
                </script>
                                </div>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">订单状态</label>
                                    <div class="col-sm-8" id="questcode">
                                        <select data-role="combobox" data-value-primitive="true" placeholder='<@spring.message "hapexam.order.state"/>' style="width:150px;"
										data-text-field="meaning" data-value-field="value"
										data-bind="source: resourceTypeData2, value: model.orderStatus"></select>
										 <script>kendo.bind($('#questcode'), viewModel_d);</script>
										 
										 
										 
                                </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                <div class="row">
                    <div class="col-sm-4" id="toolbar-btn">
                          
                           <span class="btn btn-primary" data-bind="click:queryResource"
                                 type="submit"><i class="fa fa-search" style="margin-right:3px;"></i><@spring.message "hap.query"/></span>
                    
                        <span class="btn btn-default" type="button" data-bind="click:resetForm"><i class="fa fa-eraser" style="margin-right:3px;"></i><@spring.message "hap.reset"/></span>
                         <span class="btn btn-primary"  data-bind="click:exportExcelFunction"><i class="fa fa-file-excel-o" style="margin-right:3px;"></i><@spring.message "hap.exportexcel"/></span>
                         
                         <script>kendo.bind($('#toolbar-btn'), viewModel);</script>
                    </div>
                    
                  
                </div>
                <br>
              &nbsp; <a href="#" onclick="choiceRole(' + rowdata.userId + ')" class="btn btn-default"><@spring.message "新建"/></a>
                <script type="text/javascript">
                function choiceRole(userId){
                	var roleWin =  $("#roleWin").data("kendoWindow");
                    roleWin.refresh('AllOrder.html?userId='+userId);
                    roleWin.center().open();
                }
                
                $("#roleWin").kendoWindow({
                    width: "900px",
                    height:"450px",
                    title: '<@spring.message "订单明细"/>',
                    actions: [
                           "Pin",
                           "Minimize",
                           "Maximize",
                           "Close"
                    ],
                    modal:true,
                    visible:false,
                    iframe:true
                              
              });
                </script>
           
                
            </div>
            <script>kendo.bind($('#inQuery'), viewModel);</script>

            <div style="clear: both;">
                <div id="inboundGrid"></div>
            </div>
        </div>     
</div>
</div>  


<script type="text/javascript">



    var crudServiceBaseUrl = '${base.contextPath}/HapExam/Order',
    inboundDataSource = new kendo.data.DataSource({
                transport: {
                    read: {
                        url: crudServiceBaseUrl + "/query",
                        type    : "POST",
                        contentType: "application/json",
                        dataType: "json"
                    },
                    destroy : {
                        url : crudServiceBaseUrl + "/removeInbound",
                        contentType: "application/json",
                        type : "POST"
                    },
                    parameterMap: function (options, type) {
                        if (type === "read") {
                        	console.log(viewModel.model.toJSON());
                            return kendo.stringify(Hap.prepareQueryParameter(viewModel.model.toJSON(), options));
                        }

                    }
                },
                batch: true,
                serverPaging: true,
                serverSorting: true,
                pageSize: 10,
                schema: {
                    data: 'rows',
                    total: 'total',
                    model: {
                        id: "",
                        fields: {
                            
                        }
                    }
                }
            });
    
    
  
       var grid = $("#inboundGrid").kendoGrid({
            dataSource: inboundDataSource,
            navigatable: false,
            height: '100%',
            resizable: true,
            scrollable: true,
            sortable: true,
           // selectable: 'multiple, rowbox',
            pageable: {
                pageSizes: [5, 10, 20, 50],
                refresh: true,
                buttonCount: 5
            },
            columns: [
                
                {
                    field: "orderNumber",
                    title: '销售订单号',
                    width: 100
                    /* template : function (rowdata) {
                      return '<a href="#" onclick="choiceRole(' + rowdata.userId + ')"><@spring.message "订单明细"/></a>'
                    } */
                   },
               
                {
                    field: "companyName",
                    title: '公司名称',
                    width: 140
                    
                    
                },
                
                {
                    field: "customerName",
                    title: '客户名称',
                    width: 100,
                    
                    attributes: {style: "text-align:center"}
                },
                
                {
                    field: "orderDate",
                    title: '顶单日期',
                    width: 60,
                    format: "{0:yyyy-MM-dd}",
                    attributes: {style: "text-align:center"}
                },

                
                {
                    field: "orderStatus",
                    title: '订单状态',
                    width: 80,
                    attributes: {style: "text-align:center"}
                },
                
                {
                    field: "unitSellingPrice",
                    title: '订单金额',
                    width: 50,
                    attributes: {style: "text-align:center"}
                   
                },
              

            ]
        }).data("kendoGrid");

   


    Hap.autoResizeGrid("#inboundGrid");
    $("#inboundGrid thead>tr th").css("text-align","center");
    $("#outboundGrid thead>tr th").css("text-align","center");
    
    
  

</script>
<style>
    .fadeoff .k-textbox{
        background: #eeeeee;
    }

</style>
</body>
</html>
